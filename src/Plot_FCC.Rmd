---
title: "FCC_Plot"
author: "Kateryna Savchyn"
date: "6/20/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# read in packages
```{r packages, message = FALSE}
for (pkg in c("httr", "here", "maptools","gpclib","sp", 'sf', 'ggplot2', 'ggmap', 'osmdata', 'tidyverse', 'tigris', 'acs', 'data.table')) {
  library(pkg, character.only = TRUE)
}
```

# fcc data summarized by consumer
```{r fcc}
destfile <- here("data", "original", "FCC", "fcc_477_VT.csv")
sp <- fread(destfile, colClasses = "character")
sp[, GEOID := substr(blockcode, 1, 12)]                        # create block group level GEOID
sp[, consumer := as.integer(consumer)]                         # convert consumer to integer
sp_grp <- sp[, .(consumer_cnt = sum(consumer)), .(GEOID)]      # group by block group (GEOID) and sum consumer
```

# census block group data
```{r census}
con <- DBI::dbConnect(drv = RPostgreSQL::PostgreSQL(),
                      dbname = "gis",
                      host = "postgis_1",
                      port = "5432",
                      user = Sys.getenv("db_userid"),
                      password = Sys.getenv("db_pwd"))

mygeo <- sf::st_read(con, c("census_cb", "cb_2018_50_bg_500k"))
DBI::dbDisconnect(con)
```

# merge and plot
```{r merge_plot}
fcc_vt_w_geo <- merge(sp_grp, mygeo, by = "GEOID")         # merge data sets
fcc_vt_w_geo_sf <- st_as_sf(fcc_vt_w_geo)                  # convert to sf
plot(fcc_vt_w_geo_sf[, "consumer_cnt"])                    # plot
```



